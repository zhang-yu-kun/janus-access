generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

// ========================
// RBAC 核心模型
// ========================

model User {
  id            String    @id @default(cuid())
  name          String?
  email         String?   @unique
  emailVerified DateTime?
  image         String?
  password      String? // 可选：如果你支持邮箱密码登录（非 OAuth）

  // RBAC 关联
  userRoles UserRole[]
  roleIds   String[] // 可选：用于快速查询（非必须，可删）

  // 时间戳
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("users")
}

model Role {
  id          String  @id @default(cuid())
  name        String  @unique // e.g., "admin", "editor", "viewer"
  description String?

  // 关联
  userRoles       UserRole[]
  permissions     Permission[]     @relation("RolePermissions")
  permissionRoles PermissionRole[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("roles")
}

model Permission {
  id          String  @id @default(cuid())
  name        String  @unique
  description String?

  roles           Role[]           @relation("RolePermissions")
  permissionRoles PermissionRole[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("permissions")
}

// ========================
// 多对多中间表（显式定义以支持额外字段，虽然这里不需要）
// ========================

model UserRole {
  id     String @id @default(cuid())
  user   User   @relation(fields: [userId], references: [id])
  userId String
  role   Role   @relation(fields: [roleId], references: [id])
  roleId String

  assignedAt DateTime @default(now())

  @@unique([userId, roleId])
  @@map("user_roles")
}

model PermissionRole {
  id           String     @id @default(cuid())
  role         Role       @relation(fields: [roleId], references: [id])
  roleId       String
  permission   Permission @relation(fields: [permissionId], references: [id])
  permissionId String
  description  String?
  assignedAt   DateTime   @default(now())

  @@unique([roleId, permissionId])
  @@map("permission_roles")
}

model Menu {
  menuKey   String  @id
  menuName  String
  parentKey String?
  status    String
  sort      Int?    @default(1)

  @@map("menus")
}
